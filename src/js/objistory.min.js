var objistory=function(){"use strict";function u(e){return"string"==typeof e}function f(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function s(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){if(void 0===e)return!1;var r=+e;return isNaN(r)?!!String(e).toLowerCase().replace(!1,""):!!r}function p(e){return c(e)?y(!0,{},e):Array.isArray(e)?y(!0,[],e):s(e)?h(e):e}function y(e,r){r=r||{};for(var t=2;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&("[object Object]"===Object.prototype.toString.call(arguments[t][n])?e&&(r[n]=y(e,r[n],arguments[t][n])):Array.isArray(arguments[t][n])?(r[n]=[],v(e,r[n],arguments[t][n])):r[n]=h(arguments[t][n]));return r}function h(e){if("object"==typeof e)switch(Object.prototype.toString.call(e)){case"[object Date]":return new Date(e.valueOf());case"[object String]":return new String(e.valueOf());case"[object Number]":return new Number(e.valueOf());case"[object Boolean]":return new Boolean(e.valueOf());case"[object RegExp]":return new RegExp(e.valueOf())}return e}function v(e,r,t){t.forEach(function(t,n){"[object Object]"===Object.prototype.toString.call(t)?e&&(r[n]=y(e,r[n],t)):Array.isArray(t)?(r[n]=[],v(e,r[n],t)):r[n]=t})}function b(a,y){function A(e){var n,o,i,t=[];for(i=1;v>i;i++)n=h[i],n.prop===e&&(o=n,t.push({value:n.oldValue,moment:n.moment}));return o&&o.operation!==r&&t.push({value:n.newValue,moment:n.moment}),t.length>0&&!t[0].value&&t.splice(0,1),p(t)}function _(e,r){if(e&&u(e)&&!(!e.trim().length>0)){var t=e.split("."),n=b;if(t&&t.length>1)for(var o in t)n=n[t[o]];else n=b[t[0]];return!n&&r?r:n}}function m(e,r,t,n){if(v>b._oioh_version)for(var o=v;o>b._oioh_version;o--)delete h[o];v=++b._oioh_version,h[b._oioh_version]={operation:e,prop:r,oldValue:g?p(t):void 0,newValue:p(n),moment:(new Date).valueOf()}}function d(r,t,n,o){V(e,r,t,n,o)}function j(e,r,n,o){V(t,e,r,n,o)}function w(e,r,t,o){V(n,e,r,t,o)}function O(e,t,n,o){V(r,e,t,n,o)}function V(o,i,a,f,s){if(i&&u(i)&&!(!i.trim().length>0)){a=p(a);var y,v,l=s||b,h=i.split(".");if(h&&h.length>1){for(var g=0;g<h.length-1;g++)(c(l[h[g]])||Array.isArray(l[h[g]]))&&(y=l,l=l[h[g]]);v=h[h.length-1]}else v=h[0];switch(o){case t:E(y,l,v,i,a,f);break;case n:k(y,l,v,i,a,f);break;case e:N(y,l,v,i,a,f);break;case r:S(y,l,v,i,a,f)}}}function E(e,r,n,o,i,a){f(Number(n))&&Array.isArray(e)&&(r=e),l(a)||m(t,o,r[n],i),r[n]=i}function k(e,r,t,o,i,a){f(Number(t))&&Array.isArray(e)&&(r=e),l(a)||m(n,o,r[t],i),r[t]=[],i&&i.forEach(function(e){r[t].push(e)})}function N(r,t,n,o,i,a){l(a)||m(e,o,t[n],i),t[n]&&Array.isArray(t[n])?Array.isArray(i)?i.forEach(function(e){t[n].push(e)}):t[n].push(i):Array.isArray(i)?(t[n]||(t[n]=[]),i.forEach(function(e){t[n].push(e)})):t[n]=i}function S(e,t,n,o,i,a){if(l(a)||m(r,o,t[n],i),t[n])if(Array.isArray(t[n])&&i){var u=s(i)?t[n].indexOf(i):i;t[n].splice(u,1)}else delete t[n]}function D(e){if(null===e||void 0===e||""===e)return p(h);var t,n,r=[];for(n=1;v>n;n++)t=h[n],t.prop===e&&r.push(t);return p(r)}function T(i,a){var u,c,l,p;for(p=a?a:b,c=i&&f(i)?i:o,u=p._oioh_version;u>c;u--)if(l=h[u])switch(l.operation){case t:j(l.prop,l.oldValue,!0,p);break;case n:w(l.prop,l.oldValue,!0,p);break;case e:s(l.oldValue)||Array.isArray(l.oldValue)?j(l.prop,l.oldValue,!0,p):O(l.prop,l.newValue,!0,p);break;case r:d(l.prop,l.oldValue,!0,p)}p._oioh_version=c}function x(a,u,s){var c,l,p,y,g;for(g=a?a:b,l=s&&f(s)?s===i?g._oioh_version:s>0?s:o:g._oioh_version||o,p=u&&f(u)&&u>0&&v>u?u:v,c=l;p>=c;c++)if(y=h[c])switch(y.operation){case t:j(y.prop,y.newValue,!0,g);break;case n:w(y.prop,y.newValue,!0,g);break;case e:d(y.prop,y.newValue,!0,g);break;case r:O(y.prop,y.newValue,!0,g)}g._oioh_version=p}function I(e){b=e}var v,h={},b=a,g=l(y)||!1;return function(){b._oioh_version||(b._oioh_version=0),v=b._oioh_version}(),{get:_,set:j,setarray:w,add:d,del:O,upd:V,traceHistory:D,applyOn:x,restoreAt:T,changeObjectToHistorize:I,getPropertyValueHistory:A}}const e="add",r="delete",t="set",n="setarray",o=0,i=-1;var a={ADD:e,DELETE:r,SET:t,SETARRAY:n};return{historize:b,operations:a,extendValue:p,BEGINING_OF_TIME:o,END_OF_TIME:i}}();
