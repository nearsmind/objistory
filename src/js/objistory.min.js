var objistory=function(){"use strict";function r(r,c){function u(r){return"string"==typeof r}function s(r){return"number"==typeof r&&isFinite(r)&&Math.floor(r)===r}function l(r){return"object"==typeof r&&!Array.isArray(r)&&null!==r}function f(r){return"[object Object]"===Object.prototype.toString.call(r)}function p(r){if(void 0===r)return!1;var e=+r;return isNaN(e)?!!String(r).toLowerCase().replace(!1,""):!!e}function y(r,e){if(r&&u(r)&&!(!r.trim().length>0)){var o=r.split("."),t=T;if(o&&o.length>1)for(var n in o)t=t[o[n]];else t=T[o[0]];return!t&&e?e:t}}function b(r,e,o,t){if(N>T._oioh_version)for(var n=N;n>T._oioh_version;n--)delete m[n];T._oioh_version++,N=T._oioh_version,D&&(l(o)||Array.isArray(o))&&(o=j(!0,{},o)),(l(t)||Array.isArray(t))&&(t=j(!0,{},{value:t}).value),m[T._oioh_version]={operation:r,prop:e,oldValue:o,newValue:t}}function h(r,i,a,c,s){if(i&&u(i)&&!(!i.trim().length>0)){a=E(a);var l,p,y=s||T,b=i.split(".");if(b&&b.length>1){for(var h=0;h<b.length-1;h++)(f(y[b[h]])||Array.isArray(y[b[h]]))&&(l=y,y=y[b[h]]);p=b[b.length-1]}else p=b[0];switch(r){case t:A(l,y,p,i,a,c);break;case n:_(l,y,p,i,a,c);break;case e:v(l,y,p,i,a,c);break;case o:g(l,y,p,i,a,c)}}}function A(r,e,o,n,i,a){s(Number(o))&&Array.isArray(r)&&(e=r),p(a)||b(t,n,e[o],i),e[o]=i}function _(r,e,o,t,i,a){s(Number(o))&&Array.isArray(r)&&(e=r),p(a)||b(n,t,e[o],i),e[o]=[],i&&i.forEach(function(r,t){e[o].push(r)})}function v(r,o,t,n,i,a){p(a)||b(e,n,o[t],i),o[t]&&Array.isArray(o[t])?Array.isArray(i)?i.forEach(function(r,e){o[t].push(r)}):o[t].push(i):Array.isArray(i)?(o[t]||(o[t]=[]),i.forEach(function(r,e){o[t].push(r)})):o[t]=i}function g(r,e,t,n,i,a){if(p(a)||b(o,n,e[t],i),e[t])if(Array.isArray(e[t])&&i){var c=-1;c=l(i)?e[t].indexOf(i):i,e[t].splice(c,1)}else delete e[t]}function j(r,e){e=e||{};for(var o=2;o<arguments.length;o++)if(arguments[o])for(var t in arguments[o])arguments[o].hasOwnProperty(t)&&("[object Object]"===Object.prototype.toString.call(arguments[o][t])?r&&(e[t]=j(r,e[t],arguments[o][t])):Array.isArray(arguments[o][t])?(e[t]=[],d(r,e[t],arguments[o][t])):e[t]=O(arguments[o][t]));return e}function O(r){if("object"==typeof r){if("[object Date]"===Object.prototype.toString.call(r))return new Date(r.getTime());if("[object String]"===Object.prototype.toString.call(r))return new String(r.toString());if("[object Number]"===Object.prototype.toString.call(r))return new Number(r.toString());if("[object Boolean]"===Object.prototype.toString.call(r))return new Boolean(p(r))}return r}function d(r,e,o){o.forEach(function(o,t){"[object Object]"===Object.prototype.toString.call(o)?r&&(e[t]=j(r,e[t],o)):Array.isArray(o)?(e[t]=[],d(r,e[t],o)):e[t]=o})}function w(){console.log(m)}function S(r,a){var c,u,f,p;for(p=a?a:T,u=r&&s(r)?r:i,c=p._oioh_version;c>u;c--)if(f=m[c])switch(f.operation){case t:h(t,f.prop,f.oldValue,!0,p);break;case n:h(n,f.prop,f.oldValue,!0,p);break;case e:l(f.oldValue)||Array.isArray(f.oldValue)?h(t,f.prop,f.oldValue,!0,p):h(o,f.prop,f.newValue,!0,p);break;case o:h(e,f.prop,f.oldValue,!0,p)}p._oioh_version=u}function E(r){return f(r)||Array.isArray(r)?j(!0,{},r):l(r)?O(r):r}function V(r,c,u){var l,f,p,y,b;for(b=r?r:T,f=u&&s(u)?u===a?b._oioh_version:u>0?u:i:b._oioh_version||i,p=c&&s(c)&&c>0&&c<N?c:N,l=f;l<=p;l++)if(y=m[l])switch(y.operation){case t:h(t,y.prop,y.newValue,!0,b);break;case n:h(n,y.prop,y.newValue,!0,b);break;case e:h(e,y.prop,y.newValue,!0,b);break;case o:h(o,y.prop,y.newValue,!0,b)}b._oioh_version=p}function k(r){T=r}var N,m={},T=r,D=p(c)||!1;return function(){T._oioh_version||(T._oioh_version=0),N=T._oioh_version}(),{get:y,upd:h,traceHistory:w,applyOn:V,restoreAt:S,changeObjectToHistorize:k}}const e="add",o="delete",t="set",n="setarray",i=0,a=-1;return{historizeIO:r,BEGINING_OF_TIME:i,END_OF_TIME:a,SET:t,SETARRAY:n,ADD:e,DELETE:o}}();