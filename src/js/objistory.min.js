var objistory=function(){"use strict";function r(r){return"string"==typeof r}function e(r){return"number"==typeof r&&isFinite(r)&&Math.floor(r)===r}function o(r){return"object"==typeof r&&!Array.isArray(r)&&null!==r}function n(r){return"[object Object]"===Object.prototype.toString.call(r)}function t(r){if(void 0===r)return!1;var e=+r;return isNaN(e)?!!String(r).toLowerCase().replace(!1,""):!!e}function i(r){return n(r)?a(!0,{},r):Array.isArray(r)?a(!0,[],r):o(r)?c(r):r}function a(r,e){e=e||{};for(var o=2;o<arguments.length;o++)if(arguments[o])for(var n in arguments[o])arguments[o].hasOwnProperty(n)&&("[object Object]"===Object.prototype.toString.call(arguments[o][n])?r&&(e[n]=a(r,e[n],arguments[o][n])):Array.isArray(arguments[o][n])?(e[n]=[],u(r,e[n],arguments[o][n])):e[n]=c(arguments[o][n]));return e}function c(r){if("object"==typeof r)switch(Object.prototype.toString.call(r)){case"[object Date]":return new Date(r.valueOf());case"[object String]":return new String(r.valueOf());case"[object Number]":return new Number(r.valueOf());case"[object Boolean]":return new Boolean(r.valueOf());case"[object RegExp]":return new RegExp(r.valueOf())}return r}function u(r,e,o){o.forEach(function(o,n){"[object Object]"===Object.prototype.toString.call(o)?r&&(e[n]=a(r,e[n],o)):Array.isArray(o)?(e[n]=[],u(r,e[n],o)):e[n]=o})}function s(a,c){function u(e,o){if(e&&r(e)&&!(!e.trim().length>0)){var n=e.split("."),t=T;if(n&&n.length>1)for(var i in n)t=t[n[i]];else t=T[n[0]];return!t&&o?o:t}}function s(r,e,o,n){if(m>T._oioh_version)for(var t=m;t>T._oioh_version;t--)delete D[t];m=++T._oioh_version,D[T._oioh_version]={operation:r,prop:e,oldValue:x?i(o):void 0,newValue:i(n)}}function v(r,e,o,n){g(f,r,e,o,n)}function A(r,e,o,n){g(p,r,e,o,n)}function _(r,e,o,n){g(y,r,e,o,n)}function d(r,e,o,n){g(l,r,e,o,n)}function g(e,o,t,a,c){if(o&&r(o)&&!(!o.trim().length>0)){t=i(t);var u,s,h=c||T,b=o.split(".");if(b&&b.length>1){for(var v=0;v<b.length-1;v++)(n(h[b[v]])||Array.isArray(h[b[v]]))&&(u=h,h=h[b[v]]);s=b[b.length-1]}else s=b[0];switch(e){case p:j(u,h,s,o,t,a);break;case y:O(u,h,s,o,t,a);break;case f:w(u,h,s,o,t,a);break;case l:E(u,h,s,o,t,a)}}}function j(r,o,n,i,a,c){e(Number(n))&&Array.isArray(r)&&(o=r),t(c)||s(p,i,o[n],a),o[n]=a}function O(r,o,n,i,a,c){e(Number(n))&&Array.isArray(r)&&(o=r),t(c)||s(y,i,o[n],a),o[n]=[],a&&a.forEach(function(r,e){o[n].push(r)})}function w(r,e,o,n,i,a){t(a)||s(f,n,e[o],i),e[o]&&Array.isArray(e[o])?Array.isArray(i)?i.forEach(function(r,n){e[o].push(r)}):e[o].push(i):Array.isArray(i)?(e[o]||(e[o]=[]),i.forEach(function(r,n){e[o].push(r)})):e[o]=i}function E(r,e,n,i,a,c){if(t(c)||s(l,i,e[n],a),e[n])if(Array.isArray(e[n])&&a){var u=o(a)?e[n].indexOf(a):a;e[n].splice(u,1)}else delete e[n]}function V(){console.log(D)}function k(r,n){var t,i,a,c;for(c=n?n:T,i=r&&e(r)?r:h,t=c._oioh_version;t>i;t--)if(a=D[t])switch(a.operation){case p:A(a.prop,a.oldValue,!0,c);break;case y:_(a.prop,a.oldValue,!0,c);break;case f:o(a.oldValue)||Array.isArray(a.oldValue)?A(a.prop,a.oldValue,!0,c):d(a.prop,a.newValue,!0,c);break;case l:v(a.prop,a.oldValue,!0,c)}c._oioh_version=i}function N(r,o,n){var t,i,a,c,u;for(u=r?r:T,i=n&&e(n)?n===b?u._oioh_version:n>0?n:h:u._oioh_version||h,a=o&&e(o)&&o>0&&o<m?o:m,t=i;t<=a;t++)if(c=D[t])switch(c.operation){case p:A(c.prop,c.newValue,!0,u);break;case y:_(c.prop,c.newValue,!0,u);break;case f:v(c.prop,c.newValue,!0,u);break;case l:d(c.prop,c.newValue,!0,u)}u._oioh_version=a}function S(r){T=r}var m,D={},T=a,x=t(c)||!1;return function(){T._oioh_version||(T._oioh_version=0),m=T._oioh_version}(),{get:u,set:A,setarray:_,add:v,del:d,upd:g,traceHistory:V,applyOn:N,restoreAt:k,changeObjectToHistorize:S}}const f="add",l="delete",p="set",y="setarray",h=0,b=-1;var v={ADD:f,DELETE:l,SET:p,SETARRAY:y};return{historize:s,operations:v,extendValue:i,BEGINING_OF_TIME:h,END_OF_TIME:b}}();