var objistory=function(){"use strict";function r(r){return"string"==typeof r}function e(r){return"number"==typeof r&&isFinite(r)&&Math.floor(r)===r}function o(r){return"object"==typeof r&&!Array.isArray(r)&&null!==r}function t(r){return"[object Object]"===Object.prototype.toString.call(r)}function n(r){if(void 0===r)return!1;var e=+r;return isNaN(e)?!!String(r).toLowerCase().replace(!1,""):!!e}function i(r){return t(r)?a(!0,{},r):Array.isArray(r)?a(!0,[],r):o(r)?c(r):r}function a(r,e){e=e||{};for(var o=2;o<arguments.length;o++)if(arguments[o])for(var t in arguments[o])arguments[o].hasOwnProperty(t)&&("[object Object]"===Object.prototype.toString.call(arguments[o][t])?r&&(e[t]=a(r,e[t],arguments[o][t])):Array.isArray(arguments[o][t])?(e[t]=[],u(r,e[t],arguments[o][t])):e[t]=c(arguments[o][t]));return e}function c(r){if("object"==typeof r){if("[object Date]"===Object.prototype.toString.call(r))return new Date(r.getTime());if("[object String]"===Object.prototype.toString.call(r))return new String(r.toString());if("[object Number]"===Object.prototype.toString.call(r))return new Number(r.toString());if("[object Boolean]"===Object.prototype.toString.call(r))return new Boolean(n(r))}return r}function u(r,e,o){o.forEach(function(o,t){"[object Object]"===Object.prototype.toString.call(o)?r&&(e[t]=a(r,e[t],o)):Array.isArray(o)?(e[t]=[],u(r,e[t],o)):e[t]=o})}function s(a,c){function u(e,o){if(e&&r(e)&&!(!e.trim().length>0)){var t=e.split("."),n=k;if(t&&t.length>1)for(var i in t)n=n[t[i]];else n=k[t[0]];return!n&&o?o:n}}function s(r,e,o,t){if(V>k._oioh_version)for(var n=V;n>k._oioh_version;n--)delete E[n];k._oioh_version++,V=k._oioh_version,N&&(o=i(o)),t=i(t),E[k._oioh_version]={operation:r,prop:e,oldValue:o,newValue:t}}function _(e,o,n,a,c){if(o&&r(o)&&!(!o.trim().length>0)){n=i(n);var u,s,b=c||k,h=o.split(".");if(h&&h.length>1){for(var _=0;_<h.length-1;_++)(t(b[h[_]])||Array.isArray(b[h[_]]))&&(u=b,b=b[h[_]]);s=h[h.length-1]}else s=h[0];switch(e){case p:v(u,b,s,o,n,a);break;case y:A(u,b,s,o,n,a);break;case f:g(u,b,s,o,n,a);break;case l:j(u,b,s,o,n,a)}}}function v(r,o,t,i,a,c){e(Number(t))&&Array.isArray(r)&&(o=r),n(c)||s(p,i,o[t],a),o[t]=a}function A(r,o,t,i,a,c){e(Number(t))&&Array.isArray(r)&&(o=r),n(c)||s(y,i,o[t],a),o[t]=[],a&&a.forEach(function(r,e){o[t].push(r)})}function g(r,e,o,t,i,a){n(a)||s(f,t,e[o],i),e[o]&&Array.isArray(e[o])?Array.isArray(i)?i.forEach(function(r,t){e[o].push(r)}):e[o].push(i):Array.isArray(i)?(e[o]||(e[o]=[]),i.forEach(function(r,t){e[o].push(r)})):e[o]=i}function j(r,e,t,i,a,c){if(n(c)||s(l,i,e[t],a),e[t])if(Array.isArray(e[t])&&a){var u=-1;u=o(a)?e[t].indexOf(a):a,e[t].splice(u,1)}else delete e[t]}function d(){console.log(E)}function O(r,t){var n,i,a,c;for(c=t?t:k,i=r&&e(r)?r:b,n=c._oioh_version;n>i;n--)if(a=E[n])switch(a.operation){case p:_(p,a.prop,a.oldValue,!0,c);break;case y:_(y,a.prop,a.oldValue,!0,c);break;case f:o(a.oldValue)||Array.isArray(a.oldValue)?_(p,a.prop,a.oldValue,!0,c):_(l,a.prop,a.newValue,!0,c);break;case l:_(f,a.prop,a.oldValue,!0,c)}c._oioh_version=i}function w(r,o,t){var n,i,a,c,u;for(u=r?r:k,i=t&&e(t)?t===h?u._oioh_version:t>0?t:b:u._oioh_version||b,a=o&&e(o)&&o>0&&o<V?o:V,n=i;n<=a;n++)if(c=E[n])switch(c.operation){case p:_(p,c.prop,c.newValue,!0,u);break;case y:_(y,c.prop,c.newValue,!0,u);break;case f:_(f,c.prop,c.newValue,!0,u);break;case l:_(l,c.prop,c.newValue,!0,u)}u._oioh_version=a}function S(r){k=r}var V,E={},k=a,N=n(c)||!1;return function(){k._oioh_version||(k._oioh_version=0),V=k._oioh_version}(),{get:u,upd:_,traceHistory:d,applyOn:w,restoreAt:O,changeObjectToHistorize:S}}const f="add",l="delete",p="set",y="setarray",b=0,h=-1;var _={ADD:f,DELETE:l,SET:p,SETARRAY:y};return{historize:s,operations:_,extendValue:i,BEGINING_OF_TIME:b,END_OF_TIME:h}}();